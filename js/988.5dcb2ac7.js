"use strict";(self["webpackChunkdesigner"]=self["webpackChunkdesigner"]||[]).push([[988],{1988:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("div",{staticClass:"header"},[t("h1",{staticClass:"center-text"},[e._v(e._s(e.lang.tips17))])]),t("div",{staticClass:"content"},[t("div",{staticClass:"drag-drop-field",on:{drop:e.handleDrop,dragover:function(e){e.preventDefault()}}},e._l(e.images,(function(s,a){return t("div",{key:a,staticClass:"image-item"},[t("img",{attrs:{src:s.url,alt:"Image"}}),t("button",{staticClass:"delete-button",on:{click:function(t){return e.deleteImage(a)}}})])})),0),t("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"file-input"},on:{change:e.handleFileInput}}),t("label",{staticClass:"file-upload-button",attrs:{for:"file-input"}},[e._v(" "+e._s(e.lang.tips18)+" ")]),t("p",{staticClass:"upload-info"},[e._v(" "+e._s(e.lang.tips19)+" ")]),t("div",{staticClass:"footer"},[t("button",{staticClass:"el-button el-button--default",on:{click:e.goBack}},[e._v(e._s(e.lang.tips3))]),t("button",{staticClass:"el-button el-button--success",attrs:{disabled:e.uploading},on:{click:e.upload}},[e._v(" "+e._s(e.uploading?"Uploading...":"Upload")+" ")])])])])},i=[];const o={data(){return{images:[],uploading:!1,uploadProgress:0,uploadTips:[]}},created(){if(this.lang=this.$lang("board"),this.user=JSON.parse(localStorage.getItem("designer_user")),0==this.user.projects.substring(1).length)return this.list=[],void(this.loading=!1);this.getList()},methods:{handleDrop(e){e.preventDefault();const t=e.dataTransfer.files;this.handleFiles(t)},handleFileInput(e){const t=e.target.files;this.handleFiles(t)},handleFiles(e){for(let t=0;t<e.length;t++){const s=e[t],a=new FileReader;a.onload=()=>{const e=a.result,t=s.name.split(".").pop();this.images.push({id:Date.now(),url:e,extension:t})},a.readAsDataURL(s)}},deleteImage(e){this.images.splice(e,1)},getFileLastName(e){const t=e.split(".").pop();return t.toLowerCase()},upload(){const e=["jpg","jpeg","png"];if(0===this.images.length)return void this.$message.error("No files to upload");this.uploading=!0,this.uploadProgress=0,this.uploadTips=[];const t=new FormData;for(let a=0;a<this.images.length;a++){const s=this.images[a],i=s.extension.toLowerCase();if(!e.includes(i))return this.$message.error("Unsupported file type"),void(this.uploading=!1);{const e=this.dataURLtoFile(s.url,`image_${a+1}.${i}`);t.append("file[]",e),t.append("id[]",s.id)}}t.append("createrId",JSON.parse(localStorage.getItem("designer_user")).id),t.append("groupId",this.$route.query.id),t.append("fileType","YOUR_FILE_TYPE");const s=new XMLHttpRequest;s.upload.onprogress=e=>{this.uploadProgress=parseFloat((e.loaded/e.total*100).toFixed(2))},s.open("POST","https://simplerevise.com/api/project/uploadMultiple/",!0),s.onreadystatechange=()=>{if(200===s.status&&4===s.readyState){const e=JSON.parse(s.response);200===e.code?(setTimeout((()=>{this.uploadTips.push("Parsing file")}),1e3),setTimeout((()=>{this.uploadTips.push("Saving data")}),2e3),setTimeout((()=>{this.uploading=!1,this.$router.go(0)}),3e3)):(Message.error({message:e.msg}),this.uploading=!1)}},s.onerror=()=>{MessageBox({title:"System Error: #500",message:"网络错误，请联系管理员！错误代码：500",type:"error",closeOnPressEscape:!1,closeOnClickModal:!1,showClose:!1,confirmButtonClass:"el-button--danger",callback(){window.location.reload()}}),this.uploading=!1},s.send(t),alert("上传成功"),this.$router.go(-1)},goBack(){this.$router.go(-1)},dataURLtoFile(e,t){const s=e.split(","),a=s[0].match(/:(.*?);/)[1],i=atob(s[1]);let o=i.length;const l=new Uint8Array(o);while(o--)l[o]=i.charCodeAt(o);return new File([l],t,{type:a})}}},l=o;var n=s(3736),r=(0,n.Z)(l,a,i,!1,null,"c7b071c0",null);const d=r.exports}}]);
//# sourceMappingURL=988.5dcb2ac7.js.map