{"version":3,"file":"js/988.5dcb2ac7.js","mappings":"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","sources":["webpack://designer/./src/views/upload.vue?65de","webpack://designer/src/views/upload.vue","webpack://designer/./src/views/upload.vue?a98f","webpack://designer/./src/views/upload.vue"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"container\"},[_c('div',{staticClass:\"header\"},[_c('h1',{staticClass:\"center-text\"},[_vm._v(_vm._s(_vm.lang.tips17))])]),_c('div',{staticClass:\"content\"},[_c('div',{staticClass:\"drag-drop-field\",on:{\"drop\":_vm.handleDrop,\"dragover\":function($event){$event.preventDefault();}}},_vm._l((_vm.images),function(image,index){return _c('div',{key:index,staticClass:\"image-item\"},[_c('img',{attrs:{\"src\":image.url,\"alt\":\"Image\"}}),_c('button',{staticClass:\"delete-button\",on:{\"click\":function($event){return _vm.deleteImage(index)}}})])}),0),_c('input',{staticStyle:{\"display\":\"none\"},attrs:{\"type\":\"file\",\"id\":\"file-input\"},on:{\"change\":_vm.handleFileInput}}),_c('label',{staticClass:\"file-upload-button\",attrs:{\"for\":\"file-input\"}},[_vm._v(\" \"+_vm._s(_vm.lang.tips18)+\" \")]),_c('p',{staticClass:\"upload-info\"},[_vm._v(\" \"+_vm._s(_vm.lang.tips19)+\" \")]),_c('div',{staticClass:\"footer\"},[_c('button',{staticClass:\"el-button el-button--default\",on:{\"click\":_vm.goBack}},[_vm._v(_vm._s(_vm.lang.tips3))]),_c('button',{staticClass:\"el-button el-button--success\",attrs:{\"disabled\":_vm.uploading},on:{\"click\":_vm.upload}},[_vm._v(\" \"+_vm._s(_vm.uploading ? 'Uploading...' : 'Upload')+\" \")])])])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"container\">\r\n        <div class=\"header\">\r\n            <h1 class=\"center-text\">{{ lang.tips17 }}</h1>\r\n        </div>\r\n        <div class=\"content\">\r\n            <div class=\"drag-drop-field\" @drop=\"handleDrop\" @dragover.prevent>\r\n                <div v-for=\"(image, index) in images\" :key=\"index\" class=\"image-item\">\r\n                    <img :src=\"image.url\" alt=\"Image\" />\r\n                    <button class=\"delete-button\" @click=\"deleteImage(index)\"></button>\r\n                </div>\r\n            </div>\r\n            <input type=\"file\" id=\"file-input\" @change=\"handleFileInput\" style=\"display: none\" />\r\n            <label for=\"file-input\" class=\"file-upload-button\">\r\n                {{ lang.tips18 }}\r\n            </label>\r\n            <p class=\"upload-info\">\r\n                {{ lang.tips19 }}\r\n            </p>\r\n            <div class=\"footer\">\r\n                <button class=\"el-button el-button--default\" @click=\"goBack\">{{lang.tips3}}</button>\r\n                <button class=\"el-button el-button--success\" @click=\"upload\" :disabled=\"uploading\">\r\n                    {{ uploading ? 'Uploading...' : 'Upload' }}\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n  \r\n  \r\n<script>\r\nexport default {\r\n    data() {\r\n        return {\r\n            images: [],\r\n            uploading: false,\r\n            uploadProgress: 0,\r\n            uploadTips: [],\r\n        };\r\n    },\r\n    created() {\r\n        this.lang = this.$lang('board');\r\n        this.user = JSON.parse(localStorage.getItem('designer_user'));\r\n\r\n        // 没有参与项目\r\n        if (this.user.projects.substring(1).length == 0) {\r\n            this.list = [];\r\n            this.loading = false;\r\n            return;\r\n        }\r\n\r\n        this.getList();\r\n\r\n    },\r\n    methods: {\r\n        handleDrop(event) {\r\n            event.preventDefault();\r\n            const files = event.dataTransfer.files;\r\n            this.handleFiles(files);\r\n        },\r\n        handleFileInput(event) {\r\n            const files = event.target.files;\r\n            this.handleFiles(files);\r\n        },\r\n        handleFiles(files) {\r\n            for (let i = 0; i < files.length; i++) {\r\n                const file = files[i];\r\n                const reader = new FileReader();\r\n                reader.onload = () => {\r\n                    const url = reader.result;\r\n                    const extension = file.name.split('.').pop(); // Get the file extension from the original file name\r\n                    this.images.push({ id: Date.now(), url: url, extension: extension });\r\n                };\r\n                reader.readAsDataURL(file);\r\n            }\r\n        },\r\n        deleteImage(index) {\r\n            this.images.splice(index, 1);\r\n        },\r\n        getFileLastName(url) {\r\n            const extension = url.split('.').pop();\r\n            return extension.toLowerCase();\r\n        },\r\n        upload() {\r\n            const fileTypes = ['jpg', 'jpeg', 'png'];\r\n\r\n            if (this.images.length === 0) {\r\n                this.$message.error('No files to upload');\r\n                return;\r\n            }\r\n\r\n            this.uploading = true;\r\n            this.uploadProgress = 0;\r\n            this.uploadTips = [];\r\n\r\n            const formData = new FormData();\r\n\r\n            for (let i = 0; i < this.images.length; i++) {\r\n                const image = this.images[i];\r\n                const extension = image.extension.toLowerCase();\r\n\r\n                if (fileTypes.includes(extension)) {\r\n                    const file = this.dataURLtoFile(image.url, `image_${i + 1}.${extension}`);\r\n                    formData.append('file[]', file);\r\n                    formData.append('id[]', image.id);\r\n                } else {\r\n                    this.$message.error('Unsupported file type');\r\n                    this.uploading = false;\r\n                    return;\r\n                }\r\n            }\r\n\r\n            formData.append('createrId', JSON.parse(localStorage.getItem('designer_user')).id);\r\n            formData.append('groupId', this.$route.query.id);\r\n            formData.append('fileType', 'YOUR_FILE_TYPE'); // Replace with your file type\r\n\r\n            const xhr = new XMLHttpRequest();\r\n            xhr.upload.onprogress = (e) => {\r\n                this.uploadProgress = parseFloat((e.loaded / e.total * 100).toFixed(2));\r\n            };\r\n\r\n            xhr.open('POST', 'https://simplerevise.com/api/project/uploadMultiple/', true);\r\n            xhr.onreadystatechange = () => {\r\n                if (xhr.status === 200 && xhr.readyState === 4) {\r\n                    const data = JSON.parse(xhr.response);\r\n                    if (data.code === 200) {\r\n                        setTimeout(() => {\r\n                            this.uploadTips.push('Parsing file');\r\n                        }, 1000);\r\n                        setTimeout(() => {\r\n                            this.uploadTips.push('Saving data');\r\n                        }, 2000);\r\n                        setTimeout(() => {\r\n                            this.uploading = false;\r\n                            this.$router.go(0);\r\n                        }, 3000);\r\n                    } else {\r\n                        Message.error({\r\n                            message: data.msg,\r\n                        });\r\n                        this.uploading = false;\r\n                    }\r\n                }\r\n            };\r\n\r\n            xhr.onerror = () => {\r\n                MessageBox({\r\n                    title: 'System Error: #500',\r\n                    message: '网络错误，请联系管理员！错误代码：500',\r\n                    type: 'error',\r\n                    closeOnPressEscape: false,\r\n                    closeOnClickModal: false,\r\n                    showClose: false,\r\n                    confirmButtonClass: 'el-button--danger',\r\n                    callback() {\r\n                        window.location.reload();\r\n                    },\r\n                });\r\n                this.uploading = false;\r\n            };\r\n\r\n            xhr.send(formData);\r\n            alert('上传成功');\r\n            this.$router.go(-1);\r\n\r\n        },\r\n        goBack() {\r\n            this.$router.go(-1);\r\n        },\r\n        dataURLtoFile(dataURL, filename) {\r\n            const arr = dataURL.split(',');\r\n            const mime = arr[0].match(/:(.*?);/)[1];\r\n            const bstr = atob(arr[1]);\r\n            let n = bstr.length;\r\n            const u8arr = new Uint8Array(n);\r\n            while (n--) {\r\n                u8arr[n] = bstr.charCodeAt(n);\r\n            }\r\n            return new File([u8arr], filename, { type: mime });\r\n        },\r\n    },\r\n};\r\n</script>\r\n  \r\n<style lang=\"less\" scoped>\r\n.container {\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding: 20px;\r\n    box-sizing: border-box;\r\n    overflow-y: auto;\r\n    max-height: 500px;\r\n}\r\n\r\n.header {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    margin-bottom: 20px;\r\n    padding: 20px;\r\n}\r\n\r\n.center-text {\r\n    text-align: center;\r\n    flex-grow: 1;\r\n}\r\n\r\n.content {\r\n    margin-bottom: 20px;\r\n}\r\n\r\n.drag-drop-field {\r\n    border: 2px dashed #ccc;\r\n    padding: 20px;\r\n    margin-bottom: 20px;\r\n    text-align: center;\r\n    height: 300px;\r\n    /* Set the height to 50% */\r\n}\r\n\r\n.image-item {\r\n    display: inline-block;\r\n    position: relative;\r\n    margin-right: 10px;\r\n    margin-bottom: 10px;\r\n    width: 20%;\r\n    height: 200px;\r\n    object-fit: cover;\r\n}\r\n\r\n.image-item img {\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n\r\n.delete-button {\r\n    position: absolute;\r\n    top: 5px;\r\n    right: 5px;\r\n    background: none;\r\n    border: none;\r\n    color: red;\r\n    cursor: pointer;\r\n    font-size: 12px;\r\n}\r\n\r\n.upload-info {\r\n    margin-top: 10px;\r\n    font-size: 14px;\r\n    color: #999;\r\n    text-align: center;\r\n}\r\n\r\n.footer {\r\n    display: flex;\r\n    justify-content: center;\r\n    /* Center the buttons horizontally */\r\n    align-items: center;\r\n    /* Center the buttons vertically */\r\n    margin-top: 20px;\r\n    padding: 20px;\r\n}\r\n\r\n.footer button {\r\n    margin-left: 10px;\r\n}\r\n\r\n.cancel-button,\r\n.upload-button {\r\n    flex: 0 0 auto;\r\n    /* Disable button stretching */\r\n}\r\n\r\n.cancel-button {\r\n    margin-right: 10px;\r\n    /* Add margin between buttons */\r\n}\r\n\r\n.upload-button {\r\n    margin-left: 10px;\r\n    /* Add margin between buttons */\r\n}\r\n\r\n.delete-button {\r\n    position: absolute;\r\n    top: 5px;\r\n    right: 5px;\r\n    width: 20px;\r\n    height: 20px;\r\n    background-color: white;\r\n    border-radius: 50%;\r\n    border: none;\r\n    color: black;\r\n    cursor: pointer;\r\n    font-size: 14px;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n}\r\n\r\n.delete-button:before {\r\n    content: 'x';\r\n}\r\n\r\n.file-upload-button {\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    padding: 10px 20px;\r\n    background-color: #ccc;\r\n    color: #333;\r\n    cursor: pointer;\r\n    margin-bottom: 20px;\r\n    text-align: center;\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./upload.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./upload.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./upload.vue?vue&type=template&id=c7b071c0&scoped=true&\"\nimport script from \"./upload.vue?vue&type=script&lang=js&\"\nexport * from \"./upload.vue?vue&type=script&lang=js&\"\nimport style0 from \"./upload.vue?vue&type=style&index=0&id=c7b071c0&prod&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"c7b071c0\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","_v","_s","lang","tips17","on","handleDrop","$event","preventDefault","_l","image","index","key","attrs","url","deleteImage","staticStyle","handleFileInput","tips18","tips19","goBack","tips3","uploading","upload","staticRenderFns","data","images","uploadProgress","uploadTips","created","$lang","user","JSON","parse","localStorage","getItem","projects","substring","length","list","loading","getList","methods","event","files","dataTransfer","handleFiles","target","i","file","reader","FileReader","onload","result","extension","name","split","pop","push","id","Date","now","readAsDataURL","splice","getFileLastName","toLowerCase","fileTypes","$message","error","formData","FormData","includes","dataURLtoFile","append","$route","query","xhr","XMLHttpRequest","onprogress","e","parseFloat","loaded","total","toFixed","open","onreadystatechange","status","readyState","response","code","setTimeout","$router","go","Message","message","msg","onerror","MessageBox","title","type","closeOnPressEscape","closeOnClickModal","showClose","confirmButtonClass","callback","window","location","reload","send","alert","dataURL","filename","arr","mime","match","bstr","atob","n","u8arr","Uint8Array","charCodeAt","File","component"],"sourceRoot":""}